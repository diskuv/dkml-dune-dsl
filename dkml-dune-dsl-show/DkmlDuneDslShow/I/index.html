<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>I (dkml-dune-dsl-show.DkmlDuneDslShow.I)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">dkml-dune-dsl-show</a> &#x00BB; <a href="../index.html">DkmlDuneDslShow</a> &#x00BB; I</nav><header class="odoc-preamble"><h1>Module <code><span>DkmlDuneDslShow.I</span></code></h1><p>An interpreter of the Dune DSL whose interpreted result is a s-exp of a valid Dune file parameterizable by Mustache JSON parameters.</p><p>Use <a href="../index.html#val-plain_hum"><code>plain_hum</code></a> or <a href="../index.html#val-pretty"><code>pretty</code></a> to show the Dune file.</p></header><nav class="odoc-toc"><ul><li><a href="#stanzas">Stanzas</a><ul><li><a href="#rules">Rules</a><ul><li><a href="#Dependencies">Dependencies</a></li><li><a href="#actions">Actions</a></li></ul></li><li><a href="#executables-and-libraries">Executables and Libraries</a><ul><li><a href="#Preprocessing">Preprocessing</a></li><li><a href="#Ordered-Sets">Ordered Sets</a></li></ul></li><li><a href="#Libraries">Libraries Only</a></li><li><a href="#Executables">Executables Only</a></li><li><a href="#Install">Install</a><ul><li><a href="#install-destination">Install Destination</a></li></ul></li></ul></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-repr"><a href="#type-repr" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a repr</span></span><span> = <span><a href="../index.html#type-args">args</a> <span class="arrow">&#45;&gt;</span></span> <a href="../index.html#type-out">out</a></span></code></div><div class="spec-doc"><p>A type that represents the stanzas and stanza arguments of a Dune file.</p></div></div><h3 id="stanzas"><a href="#stanzas" class="anchor"></a>Stanzas</h3><div class="odoc-spec"><div class="spec value anchored" id="val-rule"><a href="#val-rule" class="anchor"></a><code><span><span class="keyword">val</span> rule : <span><span><span><span>[ `RuleClause ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Stanza ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p>The <code>rule [rule_clause1 ...]</code> stanza is used to create custom user rules. It tells Dune how to generate a specific set of files from a specific set of dependencies.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-executable"><a href="#val-executable" class="anchor"></a><code><span><span class="keyword">val</span> executable : <span><span><span><span>[ `Executable ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Stanza ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p>The <code>executable [name &quot;&lt;name&gt;&quot;; ...]</code> stanza must be used to describe an executable.</p><p><code>&quot;&lt;name&gt;&quot;</code> is a module name that contains the executable's main entry point. There can be additional modules in the current directory; you only need to specify the entry point. Given an executable stanza with <code>name &quot;&lt;name&gt;&quot;; ...</code>, Dune will know how to build <code>&quot;&lt;name&gt;.exe&quot;</code>. If requested, it will also know how to build <code>&quot;&lt;name&gt;.bc&quot;</code> and <code>&quot;&lt;name&gt;.bc.js&quot;</code>. Dune 2.0 and up also need specific configuration (see the <a href="#val-modes"><code>modes</code></a> optional field below).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-library"><a href="#val-library" class="anchor"></a><code><span><span class="keyword">val</span> library : <span><span><span><span>[ `Library ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Stanza ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p>The <code>library [name &quot;&lt;library-name&gt;&quot;; ...]</code> stanza must be used to describe OCaml libraries.</p><p><code>&quot;&lt;library-name&gt;&quot;</code> is the real name of the library. It determines the names of the archive files generated for the library as well as the module name under which the library will be available, unless <code>wrapped false</code> is used (see <a href="#val-wrapped"><code>wrapped</code></a>). It must be a valid OCaml module name, but it doesn't need to start with an uppercase letter.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-install"><a href="#val-install" class="anchor"></a><code><span><span class="keyword">val</span> install : <span><span><span><span>[ `Install ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Stanza ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>install</code> copies freshly built artifacts from the workspace to the system.</p><p>The install stanza takes three pieces of information:</p><ol><li>the list of files to install</li><li>the package to attach these files. (This field is optional if your project contains a single package.)</li><li>the <a href="#val-section"><code>section</code></a> in which the files will be installed</li></ol><p>See <a href="#Install">Install</a> for how to specify the three pieces of information.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pragma"><a href="#val-pragma" class="anchor"></a><code><span><span class="keyword">val</span> pragma : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>[ `Stanza ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Stanza ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>pragma instruction stanza</code> gives an <code>instruction</code> to the interpreter that modifies the behavior of a Dune <code>stanza</code>.</p><p>The standard pragmas are:</p><ol><li><code>&quot;once&quot;</code> - Use this for the <b>dkml-dune-dsl-show</b> interpreter, and any other compliant interpreter, to indicate that the <code>stanza</code> should be included at most once. Often you will have common build rules that should not be include multiple times simply because you have multiple parameter sets.</li></ol><p>For the <b>dkml-dune-dsl-show</b> interpreter, a tell-tale sign that you should use <code>&quot;once&quot;</code> is when your rules do not have any parameters <code>&quot;{{ }}&quot;</code> in them.</p></div></div><h4 id="rules"><a href="#rules" class="anchor"></a>Rules</h4><div class="odoc-spec"><div class="spec value anchored" id="val-alias"><a href="#val-alias" class="anchor"></a><code><span><span class="keyword">val</span> alias : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `RuleClause ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>alias name</code> specifies the rule’s alias is <code>name</code>. Building the alias <code>name</code> means building the targets of this rule and all other rules that share the <code>name</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-targets"><a href="#val-targets" class="anchor"></a><code><span><span class="keyword">val</span> targets : <span><span><span>[&lt; <span>`S of string</span> <span><span>| `Split</span> of string</span> ]</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `RuleClause ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>targets filenames</code> is a list of <code>filenames</code> that will be produced by the rule.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-target"><a href="#val-target" class="anchor"></a><code><span><span class="keyword">val</span> target : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `RuleClause ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>target filename</code> is the <code>filename</code> that will be produced by the rule.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-deps"><a href="#val-deps" class="anchor"></a><code><span><span class="keyword">val</span> deps : <span><span><span><span>[ `Dep ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `RuleClause ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>deps [dep1; ...]</code> declares dependencies <code>[dep1; ...]</code> required by the rule.</p><p>See <a href="#Dependencies">Dependencies</a> for which dependencies are allowed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-action"><a href="#val-action" class="anchor"></a><code><span><span class="keyword">val</span> action : <span><span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `RuleClause ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>action &lt;action&gt;</code> is what you run to produce the targets from the dependencies.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-mode"><a href="#type-mode" class="anchor"></a><code><span><span class="keyword">type</span> mode</span><span> = </span></code><ol><li id="type-mode.Standard" class="def variant constructor anchored"><a href="#type-mode.Standard" class="anchor"></a><code><span>| </span><span><span class="constructor">Standard</span></span></code></li><li id="type-mode.Fallback" class="def variant constructor anchored"><a href="#type-mode.Fallback" class="anchor"></a><code><span>| </span><span><span class="constructor">Fallback</span></span></code></li><li id="type-mode.Promote" class="def variant constructor anchored"><a href="#type-mode.Promote" class="anchor"></a><code><span>| </span><span><span class="constructor">Promote</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mode"><a href="#val-mode" class="anchor"></a><code><span><span class="keyword">val</span> mode : <span><a href="#type-mode">mode</a> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `RuleClause ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>mode mode</code> can change the default (<a href="#type-mode.Standard"><code>Standard</code></a>) behavior when a source file exists with the same name as the rule <a href="#val-target"><code>target</code></a>.</p><ul><li><code>Standard</code> - the standard mode.</li><li><code>Fallback</code> - in this mode, when the targets are already present in the source tree, Dune will ignore the rule. It's an error if only a subset of the targets are present in the tree. Fallback rules are commonly used to generate default configuration files that may be generated by a configure script.</li><li><code>Promote</code> - in this mode, the files in the source tree will be ignored. Once the rule has been executed, the targets will be copied back to the source tree.</li></ul></div></div><h5 id="Dependencies"><a href="#Dependencies" class="anchor"></a>Dependencies</h5><div class="odoc-spec"><div class="spec value anchored" id="val-glob_files"><a href="#val-glob_files" class="anchor"></a><code><span><span class="keyword">val</span> glob_files : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Dep ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>glob_files glob</code> depends on all files matched by <code>glob</code>.</p><p>You can use globs to declare dependencies on a set of files. Note that globs will match files that exist in the source tree as well as buildable targets, so for instance you can depend on <code>&quot;*.cmi&quot;</code>.</p><p>The glob syntax is interpreted as follows:</p><ul><li><code>&quot;\\&lt;char&gt;&quot;</code> matches exactly <code>&quot;&lt;char&gt;&quot;</code>, even if it’s a special character (<code>&quot;*&quot;</code>, <code>&quot;?&quot;</code>, ...).</li><li><code>&quot;*&quot;</code> matches any sequence of characters, except if it comes first, in which case it matches any character that is not . followed by anything.</li><li><code>&quot;**&quot;</code> matches any character that is not . followed by anything, except if it comes first, in which case it matches anything.</li><li><code>&quot;?&quot;</code> matches any single character.</li><li><code>&quot;[&lt;set&gt;]&quot;</code> matches any character that is part of <code>&quot;&lt;set&gt;&quot;</code>.</li><li><code>&quot;[!&lt;set&gt;]&quot;</code> matches any character that is not part of <code>&quot;&lt;set&gt;&quot;</code>.</li><li><code>&quot;{&lt;glob1&gt;,&lt;glob2&gt;,...,&lt;globn&gt;}&quot;</code> matches any string that is matched by one of <code>&quot;&lt;glob1&gt;&quot;</code>, <code>&quot;&lt;glob2&gt;&quot;</code>, etc.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-named_dep"><a href="#val-named_dep" class="anchor"></a><code><span><span class="keyword">val</span> named_dep : <span>name:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Dep ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>named_dep ~name file</code> depends on the <code>file</code> and labels the file as <code>name</code>.</p><p>The <code>name</code> label may be used in the rule's <a href="#val-action"><code>action</code></a>. For example, if <code>name = &quot;the-cookbook&quot;</code> then the expression <code>%{the-cookbook}</code> can be used in the <a href="#val-action"><code>action</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-alias_dep"><a href="#val-alias_dep" class="anchor"></a><code><span><span class="keyword">val</span> alias_dep : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Dep ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>alias_dep alias</code> depends on the alias named <code>alias</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file_dep"><a href="#val-file_dep" class="anchor"></a><code><span><span class="keyword">val</span> file_dep : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Dep ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>file_dep file</code> depends on the file named <code>file</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file_deps"><a href="#val-file_deps" class="anchor"></a><code><span><span class="keyword">val</span> file_deps : <span><span><span>[&lt; <span>`S of string</span> <span><span>| `Split</span> of string</span> ]</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Dep ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>file_deps [`S file1; `S file2; ...]</code> depends on the list of files <code>file1; file2; ...</code>.</p></div></div><h5 id="actions"><a href="#actions" class="anchor"></a>Actions</h5><div class="odoc-spec"><div class="spec value anchored" id="val-echo"><a href="#val-echo" class="anchor"></a><code><span><span class="keyword">val</span> echo : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>echo [s1; s2; ...]</code> writes the strings <code>s1; s2; ...</code> to the standard output separated by a space.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_stdin_from"><a href="#val-with_stdin_from" class="anchor"></a><code><span><span class="keyword">val</span> with_stdin_from : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>with_stdin_from filename action</code> redirects the input of action <code>action</code> from the file named <code>filename</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_stdout_to"><a href="#val-with_stdout_to" class="anchor"></a><code><span><span class="keyword">val</span> with_stdout_to : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>with_stdout_to filename action</code> redirects the output of action <code>action</code> to the file named <code>filename</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-progn"><a href="#val-progn" class="anchor"></a><code><span><span class="keyword">val</span> progn : <span><span><span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>progn [action1; action2; ...]</code> executes several actions <code>action1; ...</code> in sequence</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy"><a href="#val-copy" class="anchor"></a><code><span><span class="keyword">val</span> copy : <span>src:string <span class="arrow">&#45;&gt;</span></span> <span>dest:string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>copy ~src ~dest</code> copies the <code>src</code> file to <code>dest</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><span><span>[&lt; <span>`S of string</span> <span><span>| `Split</span> of string</span> ]</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>run [`S prog; `S arg1; `S arg2; ...]</code> runs the program <code>prog</code> and gives it arguments <code>arg1; arg2; ...</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-diff"><a href="#val-diff" class="anchor"></a><code><span><span class="keyword">val</span> diff : <span>actual:string <span class="arrow">&#45;&gt;</span></span> <span>expected:string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>diff ~actual ~expected</code> is similar to <code>run [&quot;diff&quot;; &quot;&lt;actual&gt;&quot;; &quot;&lt;expected&gt;&quot;]</code> but is better and allows promotion. See <a href="https://dune.readthedocs.io/en/stable/concepts.html#diffing-and-promotion">Diffing and promotion</a> for more details.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-diff_q"><a href="#val-diff_q" class="anchor"></a><code><span><span class="keyword">val</span> diff_q : <span>actual:string <span class="arrow">&#45;&gt;</span></span> <span>expected:string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>diff_q ~actual ~expected</code> is the <code>&quot;diff?&quot;</code> action in a &quot;dune&quot; file, and is similar to <code>run [&quot;diff&quot;; &quot;&lt;actual&gt;&quot;; &quot;&lt;expected&gt;&quot;]</code> except that <code>&quot;&lt;expected&gt;&quot;</code> should be produced by a part of the same action rather than be a dependency, is optional and will be consumed by <code>diff_q</code>. See <a href="https://dune.readthedocs.io/en/stable/concepts.html#diffing-and-promotion">Diffing and promotion</a> for more details.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-setenv"><a href="#val-setenv" class="anchor"></a><code><span><span class="keyword">val</span> setenv : 
  <span>name:string <span class="arrow">&#45;&gt;</span></span>
  <span>value:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `Action ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>setenv ~name ~value action</code> sets the environment variable <code>name</code> to <code>value</code> in the action <code>action</code></p></div></div><h4 id="executables-and-libraries"><a href="#executables-and-libraries" class="anchor"></a>Executables and Libraries</h4><p>This section has expressions that work in both <a href="#val-executable"><code>executable</code></a> and <a href="#val-library"><code>library</code></a> stanzas.</p><div class="odoc-spec"><div class="spec value anchored" id="val-public_name"><a href="#val-public_name" class="anchor"></a><code><span><span class="keyword">val</span> public_name : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[&lt; `Executable <span>| `Library</span> ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>public_name</code> is the name under which the library can be referred as a dependency when it is installed outside of the current workspace, or is the name of the executable when it is installed outside of the current workspace.</p><p><b><code>public_name</code> for Libraries</b></p><p>Without a <code>(public_name ...)</code> field the library won’t be installed by Dune. The public name must start with the package name it’s part of and optionally followed by a dot, then anything else you want.</p><p><b><code>public_name</code> for Executables</b></p><p>Without a <code>(public_name ...)</code> field the executable won’t be installed by Dune.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-name"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[&lt; `Executable <span>| `Library</span> ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>name</code> is the module name that contains the executable’s main entry point, or the real name of the library.</p><p><b><code>name</code> for Libraries</b></p><p>It determines the names of the archive files generated for the library as well as the module name under which the library will be available, unless <code>(wrapped false)</code> is used (see <a href="#val-wrapped"><code>wrapped</code></a>). It must be a valid OCaml module name, but it doesn’t need to start with an uppercase letter.</p><p><b><code>name</code> for Executables</b></p><p>There can be additional modules in the current directory; you only need to specify the entry point. Given an <a href="#val-executable"><code>executable</code></a> stanza with <code>(name &lt;name&gt;)</code>, Dune will know how to build <code>&quot;&lt;name&gt;.exe&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-libraries"><a href="#val-libraries" class="anchor"></a><code><span><span class="keyword">val</span> libraries : 
  <span><span><span>[&lt; <span>`S of string</span> <span><span>| `Split</span> of string</span> ]</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; `Executable <span>| `Library</span> ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>libraries [`S lib1; `S lib2; ...]</code> specifies the library's dependencies</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-modules"><a href="#val-modules" class="anchor"></a><code><span><span class="keyword">val</span> modules : <span><span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[&lt; `Executable <span>| `Library</span> ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>modules ordered_set</code> specifies what modules are part of the library.</p><p>By default, Dune will use all the .ml/.re files in the same directory as the dune file. This includes ones present in the file system as well as ones generated by user rules. You can restrict this list by using a <code>modules ordered_set</code> field. <code>modules</code> uses the <a href="#Ordered-Sets">Ordered Sets</a> Language, where elements are module names and don't need to start with an uppercase letter. For instance, to exclude module <code>Foo</code>, use <code>modules (difference (standard) (set_of [&quot;foo&quot;]))</code>; in a real Dune file you would write that same expression as <code>&quot;(modules (:standard \ foo))&quot;</code></p><p>See <a href="#Ordered-Sets">Ordered Sets</a> for the operations you can perform.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-compilation_mode"><a href="#type-compilation_mode" class="anchor"></a><code><span><span class="keyword">type</span> compilation_mode</span><span> = </span></code><ol><li id="type-compilation_mode.Byte" class="def variant constructor anchored"><a href="#type-compilation_mode.Byte" class="anchor"></a><code><span>| </span><span><span class="constructor">Byte</span></span></code></li><li id="type-compilation_mode.Native" class="def variant constructor anchored"><a href="#type-compilation_mode.Native" class="anchor"></a><code><span>| </span><span><span class="constructor">Native</span></span></code></li><li id="type-compilation_mode.Best" class="def variant constructor anchored"><a href="#type-compilation_mode.Best" class="anchor"></a><code><span>| </span><span><span class="constructor">Best</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>compilation_mode</code> must be byte, native, or best, where best is native with a fallback to bytecode when native compilation isn't available.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-binary_kind"><a href="#type-binary_kind" class="anchor"></a><code><span><span class="keyword">type</span> binary_kind</span><span> = </span></code><ol><li id="type-binary_kind.C" class="def variant constructor anchored"><a href="#type-binary_kind.C" class="anchor"></a><code><span>| </span><span><span class="constructor">C</span></span></code></li><li id="type-binary_kind.Exe" class="def variant constructor anchored"><a href="#type-binary_kind.Exe" class="anchor"></a><code><span>| </span><span><span class="constructor">Exe</span></span></code></li><li id="type-binary_kind.Object" class="def variant constructor anchored"><a href="#type-binary_kind.Object" class="anchor"></a><code><span>| </span><span><span class="constructor">Object</span></span></code></li><li id="type-binary_kind.Shared_object" class="def variant constructor anchored"><a href="#type-binary_kind.Shared_object" class="anchor"></a><code><span>| </span><span><span class="constructor">Shared_object</span></span></code></li><li id="type-binary_kind.Js" class="def variant constructor anchored"><a href="#type-binary_kind.Js" class="anchor"></a><code><span>| </span><span><span class="constructor">Js</span></span></code></li><li id="type-binary_kind.Plugin" class="def variant constructor anchored"><a href="#type-binary_kind.Plugin" class="anchor"></a><code><span>| </span><span><span class="constructor">Plugin</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p><code>binary_kind</code> is one of:</p><ul><li><code>C</code> for producing OCaml bytecode embedded in a C file</li><li><code>Exe</code> for normal executables</li><li><code>Object</code> for producing static object files that can be manually linked into C applications</li><li><code>Shared_object</code> for producing object files that can be dynamically loaded into an application. This mode can be used to write a plugin in OCaml for a non-OCaml application.</li><li><code>Js</code> for producing JavaScript from bytecode executables, see explicit_js_mode.</li><li><code>Plugin</code> for producing a plugin (.cmxs if native or .cma if bytecode).</li></ul><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-modes"><a href="#val-modes" class="anchor"></a><code><span><span class="keyword">val</span> modes : 
  <span><span><span>[&lt; `C
  <span>| `Exe</span>
  <span>| `Object</span>
  <span>| `Shared_object</span>
  <span>| `Byte</span>
  <span>| `Native</span>
  <span>| `Js</span>
  <span>| `Plugin</span>
  <span>| `Byte_complete</span>
  <span><span>| `Mode</span> of <a href="#type-compilation_mode">compilation_mode</a> * <a href="#type-binary_kind">binary_kind</a></span> ]</span>
    list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; `Executable <span>| `Library</span> ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p>The <code>modes</code> field allows selecting which linking modes will be used to link executables. Each mode is a pair (&lt;compilation-mode&gt; &lt;binary-kind&gt;), where &lt;compilation-mode&gt; describes whether the bytecode or native code backend of the OCaml compiler should be used and &lt;binary-kind&gt; describes what kind of file should be produced.</p><p>Refer to <a href="#type-compilation_mode"><code>compilation_mode</code></a> and <a href="#type-binary_kind"><code>binary_kind</code></a> for precise semantics.</p><p>For instance the following executables stanza will produce bytecode executables and native shared objects:</p><pre>(executable
  (name &quot;a&quot;)
  (modes [`Mode (Byte, Exe); `Mode (Native; Shared_object)]))</pre><p>Additionally, you can use the following shorthands:</p><ul><li>`C for (byte c)</li><li>`Exe for (best exe)</li><li>`Object for (best object)</li><li>`Shared_object for (best shared_object)</li><li>`Byte for (byte exe)</li><li>`Native for (native exe)</li><li>`Js for (byte js)</li><li>`Plugin for (best plugin)</li></ul><p>Lastly, use the special mode <code>`Byte_complete</code> for building a bytecode executable as a native self-contained executable, i.e., an executable that doesn't require the ocamlrun program to run and doesn't require the C stubs to be installed as shared object files.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ocamlopt_flags"><a href="#val-ocamlopt_flags" class="anchor"></a><code><span><span class="keyword">val</span> ocamlopt_flags : 
  <span><span><span><span>[ `OCamlOptFlag ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[&lt; `Executable <span>| `Library</span> ]</span> <a href="#type-repr">repr</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-wrapped"><a href="#val-wrapped" class="anchor"></a><code><span><span class="keyword">val</span> wrapped : <span>bool <span class="arrow">&#45;&gt;</span></span> <span><span>[&lt; `Executable <span>| `Library</span> ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>wrapped false</code> or <code>wrapped true</code> specifies whether the library modules should be available only through the top-level library module, or if they should all be exposed at the top level.</p><p>The default is <code>wrapped true</code>, and it's highly recommended to keep it this way. Because OCaml top-level modules must all be unique when linking an executables, polluting the top-level namespace will make your library unusable with other libraries if there is a module name clash. This option is only intended for libraries that manually prefix all their modules by the library name and to ease porting of existing projects to Dune.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-preprocess"><a href="#val-preprocess" class="anchor"></a><code><span><span class="keyword">val</span> preprocess : <span><span><span>[ `PreprocessSpec ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[&lt; `Executable <span>| `Library</span> ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>preprocess spec</code> specifies how to preprocess files when needed. The default is <a href="#val-no_preprocessing"><code>no_preprocessing</code></a>.</p><p>The full list of specifications is in <a href="#Preprocessing">Preprocessing</a>.</p></div></div><h5 id="Preprocessing"><a href="#Preprocessing" class="anchor"></a>Preprocessing</h5><div class="odoc-spec"><div class="spec value anchored" id="val-no_preprocessing"><a href="#val-no_preprocessing" class="anchor"></a><code><span><span class="keyword">val</span> no_preprocessing : <span><span>[ `PreprocessSpec ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>no_preprocessing</code> tells Dune to give files as-is to the compiler</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pps"><a href="#val-pps" class="anchor"></a><code><span><span class="keyword">val</span> pps : <span><span><span>[&lt; <span>`S of string</span> <span><span>| `Split</span> of string</span> ]</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `PreprocessSpec ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>pps [`S ppx1; `S ppx2; ...]</code> preprocesses files using the given list of PPX rewriters</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-staged_pps"><a href="#val-staged_pps" class="anchor"></a><code><span><span class="keyword">val</span> staged_pps : 
  <span><span><span>[&lt; <span>`S of string</span> <span><span>| `Split</span> of string</span> ]</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `PreprocessSpec ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>staged_pps [`S ppx1; `S ppx2; ...]</code> preprocesses files using the given list of PPX rewriters <b>after</b> dependency analysis.</p><p>It is slower than <a href="#val-pps"><code>pps</code></a>, but you must use <code>staged_pps</code> instead of <code>pps</code> in order to force Dune to use the following pipeline:</p><ol><li>first stage of code generation</li><li>dependency analysis</li><li>second step of code generation in parallel with compilation</li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-future_syntax"><a href="#val-future_syntax" class="anchor"></a><code><span><span class="keyword">val</span> future_syntax : <span><span>[ `PreprocessSpec ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>future_syntax</code> is equivalent to <a href="#val-no_preprocessing"><code>no_preprocessing</code></a> when using one of the most recent versions of the compiler. When using an older one, it is a shim preprocessor that backports some of the newer syntax elements. This allows you to use some of the new OCaml features while keeping compatibility with older compilers.</p></div></div><h5 id="Ordered-Sets"><a href="#Ordered-Sets" class="anchor"></a>Ordered Sets</h5><p>For fields that can take multiple arguments, an <code>[`OrderedSet] repr</code> lets you specify your arguments using set operations. You can:</p><ul><li>list each argument out individually with <a href="#val-set_of"><code>set_of</code></a></li><li><a href="#val-split"><code>split</code></a> a string into separate arguments</li><li>use the <a href="#val-standard"><code>standard</code></a> arguments</li><li>take the <a href="#val-union"><code>union</code></a> (also known as concatenation) of any other set</li><li>take the <a href="#val-difference"><code>difference</code></a> between two sets</li></ul><p>The authorative reference is <a href="https://dune.readthedocs.io/en/stable/concepts.html#ordered-set-language-1">Ordered Set Language</a>.</p><p>Here are some common sets to get your started:</p><ul><li><code>set_of [&quot;a&quot;; &quot;b&quot;; &quot;c&quot;]</code> are the set of arguments <code>&quot;a&quot;</code>, <code>&quot;b&quot;</code> and <code>&quot;c&quot;</code></li><li><code>split &quot;a b c&quot;</code> are the set of arguments <code>&quot;a&quot;</code>, <code>&quot;b&quot;</code> and <code>&quot;c&quot;</code></li><li><code>split &quot;{{#param-sets}} {{{ module }}} {{/param-sets}}&quot;</code> are the set of arguments after calculating the Mustache expression. The <code>&quot;param-sets&quot;</code> field of your parameter file will be available if you use the <code>pragma &quot;once&quot; ...</code>; see <a href="#val-pragma"><code>pragma</code></a>. With the example Mustache expression, Mustache will collect all of the <code>module</code> fields of your parameter file into a single string, and then <code>split</code> will split those modules by atoms.</li><li><code>(difference (standard) (set_of [&quot;foo&quot;]))</code> which is all the standard arguments (ex. standard modules) except for <code>&quot;foo&quot;</code>. In a real Dune file would be written as <code>&quot;(:standard \ foo)&quot;</code></li></ul><p>It is allowed grammatically but is highly discouraged to use <code>split &quot;:standard \ compat&quot;</code>. Instead use <code>difference (standard) (each [&quot;compat&quot;])</code> so the meaning is clear and so that DSL interpreters are exposed to what you actually meant to happen.</p><div class="odoc-spec"><div class="spec value anchored" id="val-set_of"><a href="#val-set_of" class="anchor"></a><code><span><span class="keyword">val</span> set_of : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>set_of [arg1; arg2; ...]</code> are zero or more arguments <code>arg1</code>, <code>arg2</code> and so on.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-standard"><a href="#val-standard" class="anchor"></a><code><span><span class="keyword">val</span> standard : <span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>standard</code> are the standard arguments.</p><p>The standard depends on the context in which the arguments are applied. See the relevant documentation for the definition of <code>standard</code>:</p><ul><li><a href="#val-modules"><code>modules</code></a></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-split"><a href="#val-split" class="anchor"></a><code><span><span class="keyword">val</span> split : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>split &quot;arg1 arg2 ...&quot;</code> are zero or more arguments <code>arg1</code>, <code>arg2</code> and so on after splitting the given string <code>&quot;arg1 arg2 ...&quot;</code> according to the <a href="https://github.com/janestreet/sexplib#lexical-conventions-of-s-expression">Lexical conventions of s-expression</a> for identifying atoms in a list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-union"><a href="#val-union" class="anchor"></a><code><span><span class="keyword">val</span> union : <span><span><span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>union [set1; set2; ...]</code> is all the arguments from <code>set1</code> and also <code>set2</code> and so on.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-difference"><a href="#val-difference" class="anchor"></a><code><span><span class="keyword">val</span> difference : 
  <span><span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>difference a_set b_set</code> is all the arguments from <code>a_set</code> that are not in <code>b_set</code></p></div></div><h4 id="Libraries"><a href="#Libraries" class="anchor"></a>Libraries Only</h4><div class="odoc-spec"><div class="spec value anchored" id="val-virtual_modules"><a href="#val-virtual_modules" class="anchor"></a><code><span><span class="keyword">val</span> virtual_modules : <span><span><span>[ `OrderedSet ]</span> <a href="#type-repr">repr</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Library ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>virtual_modules ordered_set</code> specifies what modules for which only an interface would be present, and which will have implementations defined in other libraries.</p><p>The virtual modules play the role of interfaces or protocols in <a href="https://dune.readthedocs.io/en/stable/variants.html#virtual-library">Dune virtual libraries</a>.</p><p>See <a href="#Ordered-Sets">Ordered Sets</a> for the operations you can perform.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-implements"><a href="#val-implements" class="anchor"></a><code><span><span class="keyword">val</span> implements : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Library ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>implements libname</code> specifies the virtual library the current library (the implementing library) provides an implementation for.</p><p>See <a href="https://dune.readthedocs.io/en/stable/variants.html#virtual-library">Dune virtual libraries</a> for more details.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_implementation"><a href="#val-default_implementation" class="anchor"></a><code><span><span class="keyword">val</span> default_implementation : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Library ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>default_implementation default_impl</code> selects the default implementation for a virtual library, which is enabled after variant resolution if no suitable implementation has been found.</p></div></div><h4 id="Executables"><a href="#Executables" class="anchor"></a>Executables Only</h4><p>As of this version there are no executable-only clauses.</p><h4 id="Install"><a href="#Install" class="anchor"></a>Install</h4><div class="odoc-spec"><div class="spec value anchored" id="val-section"><a href="#val-section" class="anchor"></a><code><span><span class="keyword">val</span> section : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Install ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><code>section &quot;share&quot;</code> is the section in which the files will be installed.</p><p>The following sections are available:</p><ul><li><code>&quot;lib&quot;</code> installs by default to <code>&quot;/lib/&lt;pkgname&gt;/&quot;</code></li><li><code>&quot;lib_root&quot;</code> installs by default to <code>&quot;/lib/&quot;</code></li><li><code>&quot;libexec&quot;</code> installs by default to <code>&quot;/lib/&lt;pkgname&gt;/&quot;</code> with the executable bit set</li><li><code>&quot;libexec_root&quot;</code> installs by default to <code>&quot;/lib/&quot;</code> with the executable bit set</li><li><code>&quot;bin&quot;</code> installs by default to <code>&quot;/bin/&quot;</code> with the executable bit set</li><li><code>&quot;sbin&quot;</code> installs by default to <code>&quot;/sbin/&quot;</code> with the executable bit set</li><li><code>&quot;toplevel&quot;</code> installs by default to <code>&quot;/lib/toplevel/&quot;</code></li><li><code>&quot;share&quot;</code> installs by default to <code>&quot;/share/&lt;pkgname&gt;/&quot;</code></li><li><code>&quot;share_root&quot;</code> installs by default to <code>&quot;/share/&quot;</code></li><li><code>&quot;etc&quot;</code> installs by default to <code>&quot;/etc/&lt;pkgname&gt;/&quot;</code></li><li><code>&quot;doc&quot;</code> installs by default to <code>&quot;/doc/&lt;pkgname&gt;/&quot;</code></li><li><code>&quot;stublibs&quot;</code> installs by default to <code>&quot;/lib/stublibs/&quot;</code> with the executable bit set</li><li><code>&quot;man&quot;</code> installs by default relative to <code>&quot;/man&quot;</code> with the destination directory extracted from the extension of the source file (so that installing foo.1 is equivalent to a destination of man1/foo.1)</li><li><code>&quot;misc&quot;</code> requires files to specify an absolute destination. It will only work when used with opam and the user will be prompted before the installation when it's done via opam. It is deprecated.</li></ul><p>The following sections are not yet available in Dune DSL:</p><ul><li><code>&quot;(site (&lt;package&gt; &lt;site&gt;))&quot;</code> installs in the &lt;site&gt; directory of &lt;package&gt;. If the prefix isn't the same as the one used when installing &lt;package&gt;, &lt;package&gt; won't find the files.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-install_files"><a href="#val-install_files" class="anchor"></a><code><span><span class="keyword">val</span> install_files : <span><span><span><span>[ `InstallDestination ]</span> <a href="#type-repr">repr</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `Install ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><a href="https://dune.readthedocs.io/en/stable/dune-files.html#install-1">https://dune.readthedocs.io/en/stable/dune-files.html#install-1</a>.</p></div></div><h5 id="install-destination"><a href="#install-destination" class="anchor"></a>Install Destination</h5><div class="odoc-spec"><div class="spec value anchored" id="val-destination_file"><a href="#val-destination_file" class="anchor"></a><code><span><span class="keyword">val</span> destination_file : 
  <span>filename:string <span class="arrow">&#45;&gt;</span></span>
  <span>destination:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>[ `InstallDestination ]</span> <a href="#type-repr">repr</a></span></span></code></div><div class="spec-doc"><p><a href="https://dune.readthedocs.io/en/stable/dune-files.html#install-1">https://dune.readthedocs.io/en/stable/dune-files.html#install-1</a>.</p><p><code>destination_file ~filename ~destination</code> represents the sub-expression:</p><pre>(mylib.el as emacs/site-lisp/mylib.el)</pre><p>in</p><pre>(files   (mylib.el as emacs/site-lisp/mylib.el))</pre></div></div></div></body></html>